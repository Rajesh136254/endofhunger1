{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>useContext(AuthContext);export const AuthProvider=_ref=>{let{children}=_ref;const[currentUser,setCurrentUser]=useState(null);const[isLoading,setIsLoading]=useState(true);const API_URL=process.env.REACT_APP_API_URL;useEffect(()=>{// Check if user is logged in on app load\nconst token=localStorage.getItem('token');const userData=localStorage.getItem('userData');if(token&&userData){try{const user=JSON.parse(userData);setCurrentUser(user);}catch(error){console.error('Error parsing user data:',error);localStorage.removeItem('token');localStorage.removeItem('userData');}}setIsLoading(false);},[]);const login=async(email,password)=>{try{const response=await fetch(\"\".concat(API_URL,\"/api/auth/login\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});const data=await response.json();if(data.success){localStorage.setItem('token',data.token||'dummy-token');localStorage.setItem('userData',JSON.stringify(data.data));setCurrentUser(data.data);return{success:true};}else{return{success:false,message:data.message||'Login failed'};}}catch(error){console.error('Login error:',error);return{success:false,message:'Network error. Please try again.'};}};const signup=async(fullName,email,password)=>{try{const response=await fetch(\"\".concat(API_URL,\"/api/auth/register\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({fullName,email,password})});const data=await response.json();if(data.success){// Auto-login after successful registration\nreturn await login(email,password);}else{return{success:false,message:data.message||'Registration failed'};}}catch(error){console.error('Signup error:',error);return{success:false,message:'Network error. Please try again.'};}};const logout=()=>{localStorage.removeItem('token');localStorage.removeItem('userData');setCurrentUser(null);};const value={currentUser,isLoading,login,signup,logout,isAuthenticated:!!currentUser,isAdmin:(currentUser===null||currentUser===void 0?void 0:currentUser.role)==='admin'};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","currentUser","setCurrentUser","isLoading","setIsLoading","API_URL","process","env","REACT_APP_API_URL","token","localStorage","getItem","userData","user","JSON","parse","error","console","removeItem","login","email","password","response","fetch","concat","method","headers","body","stringify","data","json","success","setItem","message","signup","fullName","logout","value","isAuthenticated","isAdmin","role","Provider"],"sources":["/home/user/endofhunger/dineflowreact/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [currentUser, setCurrentUser] = useState(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const API_URL = process.env.REACT_APP_API_URL;\r\n\r\n    useEffect(() => {\r\n        // Check if user is logged in on app load\r\n        const token = localStorage.getItem('token');\r\n        const userData = localStorage.getItem('userData');\r\n        \r\n        if (token && userData) {\r\n            try {\r\n                const user = JSON.parse(userData);\r\n                setCurrentUser(user);\r\n            } catch (error) {\r\n                console.error('Error parsing user data:', error);\r\n                localStorage.removeItem('token');\r\n                localStorage.removeItem('userData');\r\n            }\r\n        }\r\n        setIsLoading(false);\r\n    }, []);\r\n\r\n    const login = async (email, password) => {\r\n        try {\r\n            const response = await fetch(`${API_URL}/api/auth/login`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ email, password })\r\n            });\r\n\r\n            const data = await response.json();\r\n            \r\n            if (data.success) {\r\n                localStorage.setItem('token', data.token || 'dummy-token');\r\n                localStorage.setItem('userData', JSON.stringify(data.data));\r\n                setCurrentUser(data.data);\r\n                return { success: true };\r\n            } else {\r\n                return { success: false, message: data.message || 'Login failed' };\r\n            }\r\n        } catch (error) {\r\n            console.error('Login error:', error);\r\n            return { success: false, message: 'Network error. Please try again.' };\r\n        }\r\n    };\r\n\r\n    const signup = async (fullName, email, password) => {\r\n        try {\r\n            const response = await fetch(`${API_URL}/api/auth/register`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ fullName, email, password })\r\n            });\r\n\r\n            const data = await response.json();\r\n            \r\n            if (data.success) {\r\n                // Auto-login after successful registration\r\n                return await login(email, password);\r\n            } else {\r\n                return { success: false, message: data.message || 'Registration failed' };\r\n            }\r\n        } catch (error) {\r\n            console.error('Signup error:', error);\r\n            return { success: false, message: 'Network error. Please try again.' };\r\n        }\r\n    };\r\n\r\n    const logout = () => {\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('userData');\r\n        setCurrentUser(null);\r\n    };\r\n\r\n    const value = {\r\n        currentUser,\r\n        isLoading,\r\n        login,\r\n        signup,\r\n        logout,\r\n        isAuthenticated: !!currentUser,\r\n        isAdmin: currentUser?.role === 'admin'\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}